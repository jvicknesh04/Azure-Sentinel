{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Azure Storage Solution\n---\n"
      },
      "name": "text - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "Text to explain about the solution would lie here."
      },
      "name": "text - 6"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "af8c6e44-af5f-49b3-b64c-b35f1db29003",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                }
              ],
              "allowCustom": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "cb8953cd-4ef7-43db-9b10-e44ea5670edd",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "description": "Provide the subscription where required Workspace is located",
            "isRequired": true,
            "value": "",
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": true
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "8fad2a64-0e77-41ec-8686-e37ca8e1b67a",
            "version": "KqlParameterItem/1.0",
            "name": "workspace",
            "label": "Workspace",
            "type": 5,
            "description": "Select the workspace with required data",
            "isRequired": true,
            "value": "",
            "typeSettings": {
              "resourceTypeFilter": {
                "microsoft.operationalinsights/workspaces": true
              },
              "additionalResourceOptions": []
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 3"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "4326117d-592d-452d-82a2-c06837937d89",
            "cellValue": "tabVisibility",
            "linkTarget": "parameter",
            "linkLabel": "Azure Blob",
            "subTarget": "summary",
            "style": "link"
          },
          {
            "id": "e8ec7baf-fada-4dbc-bd28-e1b939636787",
            "cellValue": "tabVisibility",
            "linkTarget": "parameter",
            "linkLabel": "Azure Queue",
            "subTarget": "detailed",
            "style": "link"
          },
          {
            "id": "22b74130-7c95-43b4-8439-def057191a35",
            "cellValue": "tabVisibility",
            "linkTarget": "parameter",
            "linkLabel": "Azure Files",
            "subTarget": "threat",
            "style": "link"
          },
          {
            "id": "c9b48e95-0d96-4526-86af-b40b817c683b",
            "cellValue": "tabVisibility",
            "linkTarget": "parameter",
            "linkLabel": "Azure Table",
            "subTarget": "ipinvest",
            "style": "link"
          }
        ]
      },
      "name": "links - 4"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Summary of Azure Blob requests",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let totalConnection = StorageBlobLogs\r\n| count\r\n| extend Product = \"Total Connections\", orderNum = 1;\r\nlet Accountname = StorageBlobLogs\r\n| summarize count() by AccountName\r\n| count\r\n| extend Product = \"Unique Accountnames\", orderNum = 2;\r\nlet uniqueIpAddress = StorageBlobLogs\r\n| summarize count() by CallerIpAddress\r\n| count \r\n| extend Product = \"Unique Caller IPAddresses\", orderNum = 3;\r\nlet successfulrequests = StorageBlobLogs\r\n| where StatusText has \"Success\"\r\n| count\r\n| extend Product = \"Successful Requests\", orderNum = 4;\r\nlet NotSuccessfulRequests = StorageBlobLogs\r\n| where StatusText !has \"Success\"\r\n| count\r\n| extend Product = \"UnSuccessful Requests\", orderNum = 5;\r\nlet AnonymousRequests =  StorageBlobLogs\r\n | where AuthenticationType has \"Anonymous\"\r\n | count   \r\n | extend Product = \"Anonymous Requests\", orderNum = 5;\r\nunion totalConnection, Accountname,uniqueIpAddress,successfulrequests,NotSuccessfulRequests\r\n| order by orderNum asc",
              "size": 4,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "tiles",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "sum_NetworkBytes",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "sum_NetworkBytes",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Product",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total Connections",
                        "representation": "Globe",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Accountnames",
                        "representation": "Person",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Caller IPAddresses",
                        "representation": "Mail",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Successful Requests",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "UnSuccessful Requests",
                        "representation": "failed",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Available",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Count",
                "size": "auto"
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Product",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "name": "Traffic - Connections"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageBlobLogs\r\n| summarize count() by AuthenticationType",
              "size": 1,
              "title": "Authentication mechanism used to access blobs",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Severity",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " StorageBlobLogs\r\n | where isnotempty(StatusText)\r\n | summarize count() by StatusText",
              "size": 1,
              "title": "Request results",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - Action",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageBlobLogs\r\n| where isnotempty(OperationName) \r\n| summarize  count() by OperationName, bin(TimeGenerated,6h)",
              "size": 1,
              "title": "Requests by OPeration Type",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Source Type",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageBlobLogs\r\n| where isnotempty(CallerIpAddress)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by CallerIpAddress\r\n| take 10",
              "size": 1,
              "title": "Requests by Top 10 IPAddress",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "timechart"
            },
            "customWidth": "50",
            "name": "Traffic - Device Hostname",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageBlobLogs\r\n| where isnotempty(Location) \r\n| summarize Instances = count() by Location\r\n| order by Instances\r\n",
              "size": 0,
              "title": "Requests from different locations over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "map",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "Location",
                "latitude": "Location",
                "longitude": "Location",
                "sizeSettings": "Instances",
                "sizeAggregation": "Sum",
                "legendMetric": "Instances",
                "numberOfMetrics": 7,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Instances",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "50",
            "name": "Traffic - NetworkDirection",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageBlobLogs\r\n| where isnotempty(Type)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by Type",
              "size": 0,
              "title": "Requests frequency over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - EventResult",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tabVisibility",
        "comparison": "isEqualTo",
        "value": "summary"
      },
      "name": "Group - Traffic - Summary"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Summary of Azure Queue requests",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let totalConnection = StorageQueueLogs\r\n| count\r\n| extend Product = \"Total Connections\", orderNum = 1;\r\nlet Accountname = StorageQueueLogs\r\n| summarize count() by AccountName\r\n| count\r\n| extend Product = \"Unique Accountnames\", orderNum = 2;\r\nlet uniqueIpAddress = StorageQueueLogs\r\n| summarize count() by CallerIpAddress\r\n| count \r\n| extend Product = \"Unique Caller IPAddresses\", orderNum = 3;\r\nlet successfulrequests = StorageQueueLogs\r\n| where StatusText has \"Success\"\r\n| count\r\n| extend Product = \"Successful Requests\", orderNum = 4;\r\nlet NotSuccessfulRequests = StorageQueueLogs\r\n| where StatusText !has \"Success\"\r\n| count\r\n| extend Product = \"UnSuccessful Requests\", orderNum = 5;\r\nlet AnonymousRequests =  StorageQueueLogs\r\n | where AuthenticationType has \"Anonymous\"\r\n | count   \r\n | extend Product = \"Anonymous Requests\", orderNum = 5;\r\nunion totalConnection, Accountname,uniqueIpAddress,successfulrequests,NotSuccessfulRequests\r\n| order by orderNum asc",
              "size": 4,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "tiles",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "sum_NetworkBytes",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "sum_NetworkBytes",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Product",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total Connections",
                        "representation": "Globe",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Accountnames",
                        "representation": "Person",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Caller IPAddresses",
                        "representation": "Mail",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Successful Requests",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "UnSuccessful Requests",
                        "representation": "failed",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Available",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Count",
                "size": "auto"
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Product",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "name": "Traffic - Connections - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageQueueLogs\r\n| summarize count() by AuthenticationType",
              "size": 1,
              "title": "Authentication mechanism used to access blobs",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Severity - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " StorageQueueLogs\r\n | where isnotempty(StatusText)\r\n | summarize count() by StatusText",
              "size": 1,
              "title": "Request results",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - Action - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageQueueLogs\r\n| where isnotempty(OperationName) \r\n| summarize  count() by OperationName, bin(TimeGenerated,6h)",
              "size": 1,
              "title": "Requests by OPeration Type",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Source Type - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageQueueLogs\r\n| where isnotempty(CallerIpAddress)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by CallerIpAddress\r\n| take 10",
              "size": 1,
              "title": "Requests by Top 10 IPAddress",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "timechart"
            },
            "customWidth": "50",
            "name": "Traffic - Device Hostname - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageQueueLogs\r\n| where isnotempty(Location) \r\n| summarize Instances = count() by Location\r\n| order by Instances\r\n",
              "size": 0,
              "title": "Requests from different locations over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "map",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "Location",
                "latitude": "Location",
                "longitude": "Location",
                "sizeSettings": "Instances",
                "sizeAggregation": "Sum",
                "legendMetric": "Instances",
                "numberOfMetrics": 7,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Instances",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "50",
            "name": "Traffic - NetworkDirection - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageQueueLogs\r\n| where isnotempty(Type)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by Type",
              "size": 0,
              "title": "Requests frequency over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - EventResult - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tabVisibility",
        "comparison": "isEqualTo",
        "value": "detailed"
      },
      "name": "Group - Traffic - Detailed"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Summary of Azure File requests",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let totalConnection = StorageFileLogs\r\n| count\r\n| extend Product = \"Total Connections\", orderNum = 1;\r\nlet Accountname = StorageFileLogs\r\n| summarize count() by AccountName\r\n| count\r\n| extend Product = \"Unique Accountnames\", orderNum = 2;\r\nlet uniqueIpAddress = StorageFileLogs\r\n| summarize count() by CallerIpAddress\r\n| count \r\n| extend Product = \"Unique Caller IPAddresses\", orderNum = 3;\r\nlet successfulrequests = StorageFileLogs\r\n| where StatusText has \"Success\"\r\n| count\r\n| extend Product = \"Successful Requests\", orderNum = 4;\r\nlet NotSuccessfulRequests = StorageFileLogs\r\n| where StatusText !has \"Success\"\r\n| count\r\n| extend Product = \"UnSuccessful Requests\", orderNum = 5;\r\nlet AnonymousRequests =  StorageFileLogs\r\n | where AuthenticationType has \"Anonymous\"\r\n | count   \r\n | extend Product = \"Anonymous Requests\", orderNum = 5;\r\nunion totalConnection, Accountname,uniqueIpAddress,successfulrequests,NotSuccessfulRequests\r\n| order by orderNum asc",
              "size": 4,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "tiles",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "sum_NetworkBytes",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "sum_NetworkBytes",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Product",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total Connections",
                        "representation": "Publish",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Accountnames",
                        "representation": "Person",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Caller IPAddresses",
                        "representation": "Mail",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Successful Requests",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "UnSuccessful Requests",
                        "representation": "failed",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Available",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Count",
                "size": "auto"
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Product",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "name": "Traffic - Connections - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageFileLogs\r\n| summarize count() by AuthenticationType",
              "size": 1,
              "title": "Authentication mechanism -Requests",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Severity - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " StorageFileLogs\r\n | where isnotempty(StatusText)\r\n | summarize count() by StatusText",
              "size": 1,
              "title": "Requests results",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - Action - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageFileLogs\r\n| where isnotempty(OperationName) \r\n| summarize  count() by OperationName, bin(TimeGenerated,6h)",
              "size": 1,
              "title": "Requests by Operation Type",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Source Type - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageFileLogs\r\n| where isnotempty(CallerIpAddress)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by CallerIpAddress\r\n| take 10",
              "size": 1,
              "title": "Requests by Top 10 IPAddress",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "timechart"
            },
            "customWidth": "50",
            "name": "Traffic - Device Hostname - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageFileLogs\r\n| where isnotempty(Location) \r\n| summarize Instances = count() by Location\r\n| order by Instances\r\n",
              "size": 0,
              "title": "Requests from different locations over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "map",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "Location",
                "latitude": "Location",
                "longitude": "Location",
                "sizeSettings": "Instances",
                "sizeAggregation": "Sum",
                "legendMetric": "Instances",
                "numberOfMetrics": 7,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Instances",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "50",
            "name": "Traffic - NetworkDirection - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageFileLogs\r\n| where isnotempty(Type)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by Type",
              "size": 0,
              "title": "Requests frequency over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - EventResult - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tabVisibility",
        "comparison": "isEqualTo",
        "value": "threat"
      },
      "name": "Group - Threat"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Summary of Azure table requests",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let totalConnection = StorageTableLogs\r\n| count\r\n| extend Product = \"Total Connections\", orderNum = 1;\r\nlet Accountname = StorageTableLogs\r\n| summarize count() by AccountName\r\n| count\r\n| extend Product = \"Unique Accountnames\", orderNum = 2;\r\nlet uniqueIpAddress = StorageTableLogs\r\n| summarize count() by CallerIpAddress\r\n| count \r\n| extend Product = \"Unique Caller IPAddresses\", orderNum = 3;\r\nlet successfulrequests = StorageTableLogs\r\n| where StatusText has \"Success\"\r\n| count\r\n| extend Product = \"Successful Requests\", orderNum = 4;\r\nlet NotSuccessfulRequests = StorageTableLogs\r\n| where StatusText !has \"Success\"\r\n| count\r\n| extend Product = \"UnSuccessful Requests\", orderNum = 5;\r\nlet AnonymousRequests =  StorageTableLogs\r\n | where AuthenticationType has \"Anonymous\"\r\n | count   \r\n | extend Product = \"Anonymous Requests\", orderNum = 5;\r\nunion totalConnection, Accountname,uniqueIpAddress,successfulrequests,NotSuccessfulRequests\r\n| order by orderNum asc",
              "size": 4,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "tiles",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "sum_NetworkBytes",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "sum_NetworkBytes",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Product",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "Total Connections",
                        "representation": "Publish",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Accountnames",
                        "representation": "Person",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Unique Caller IPAddresses",
                        "representation": "Mail",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Successful Requests",
                        "representation": "success",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "UnSuccessful Requests",
                        "representation": "failed",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "Available",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "none"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    },
                    "emptyValCustomText": "0"
                  }
                },
                "showBorder": true,
                "sortCriteriaField": "Count",
                "size": "auto"
              },
              "graphSettings": {
                "type": 0,
                "topContent": {
                  "columnMatch": "Product",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "name": "Traffic - Connections - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageTableLogs\r\n| summarize count() by AuthenticationType",
              "size": 1,
              "title": "Authentication mechanism -Requests",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Severity - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": " StorageTableLogs\r\n | where isnotempty(StatusText)\r\n | summarize count() by StatusText",
              "size": 1,
              "title": "Requests results",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "barchart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - Action - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageTableLogs\r\n| where isnotempty(OperationName) \r\n| summarize  count() by OperationName, bin(TimeGenerated,6h)",
              "size": 1,
              "title": "Requests by Operation Type",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart"
            },
            "customWidth": "50",
            "name": "Traffic - Source Type - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageTableLogs\r\n| where isnotempty(CallerIpAddress)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by CallerIpAddress\r\n| take 10",
              "size": 1,
              "title": "Requests by Top 10 IPAddress",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "timechart"
            },
            "customWidth": "50",
            "name": "Traffic - Device Hostname - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageTableLogs\r\n| where isnotempty(Location) \r\n| summarize Instances = count() by Location\r\n| order by Instances\r\n",
              "size": 0,
              "title": "Requests from different locations over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "map",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "AzureLoc",
                "locInfoColumn": "Location",
                "latitude": "Location",
                "longitude": "Location",
                "sizeSettings": "Instances",
                "sizeAggregation": "Sum",
                "legendMetric": "Instances",
                "numberOfMetrics": 7,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "Instances",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "customWidth": "50",
            "name": "Traffic - NetworkDirection - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "StorageTableLogs\r\n| where isnotempty(Type)\r\n| make-series Instances=count() on bin(TimeGenerated,1h) from {TimeRange:start} to {TimeRange:end} step 1h by Type",
              "size": 0,
              "title": "Requests frequency over time",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{workspace}"
              ],
              "visualization": "areachart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DvcAction",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Instances",
                  "formatter": 19,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false
              },
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "customWidth": "50",
            "name": "Traffic - EventResult - Copy - Copy - Copy",
            "styleSettings": {
              "margin": "10",
              "padding": "10",
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "tabVisibility",
        "comparison": "isEqualTo",
        "value": "ipinvest"
      },
      "name": "Group - IP Investigate"
    }
  ],
  "fromTemplateId": "sentinel-AzureStorageWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}